name: Build MeepMeep

on:
  pull_request:
    types:
      - opened
  workflow_dispatch:

permissions:
  contents: read

jobs:
  check:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          distribution: 'adopt'
          java-version: '17'

      - name: Build MeepMeep
        run: ./gradlew --no-daemon build

      - name: Test MeepMeep
        run: ./gradlew --no-daemon test

      - name: Report status
        uses: actions/github-script@v6
        with:
          script: |
            const { context, getOctokit } = require('@actions/github');
            const { owner, repo } = context.repo;
            const pull_request = context.payload.pull_request;

            if (pull_request) {
              const octokit = getOctokit(process.env.GITHUB_TOKEN);
              await octokit.repos.createCommitStatus({
                owner,
                repo,
                sha: pull_request.head.sha,
                state: 'success',
                context: 'Build MeepMeep',
                description: 'The build succeeded!',
              });
            }
